#!/usr/bin/env php
<?php declare(strict_types=1);

require_once __DIR__ . '/../../../vendor/autoload.php';

use Rector\PharBuilder\DependencyInjection\ContainerFactory;
use Rector\PharBuilder\PharBuilder;

error_reporting(-1);
ini_set('display_errors', '1');

try {
    $container = (new ContainerFactory())->create();
    /** @var PharBuilder $pharBuilder */
    $pharBuilder = $container->get(PharBuilder::class);
    $pharBuilder->build(realpath(__DIR__ . '/../../..'));
} catch (Throwable $exception) {
    echo sprintf(
        'Failed to compile phar: [%s] %s at %s:%d' . PHP_EOL,
        get_class($exception),
        $exception->getMessage(),
        $exception->getFile(),
        $exception->getLine()
    );
    exit(1);
}

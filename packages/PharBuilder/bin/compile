#!/usr/bin/env php
<?php declare(strict_types=1);

require_once __DIR__ . '/../../../vendor/autoload.php';

use Rector\PharBuilder\DependencyInjection\ContainerFactory;
use Rector\PharBuilder\PharBuilder;
use Symplify\PackageBuilder\Console\Style\SymfonyStyleFactory;

error_reporting(-1);
ini_set('display_errors', '1');

try {
    $container = (new ContainerFactory())->create();

    /** @var PharBuilder $pharBuilder */
    $pharBuilder = $container->get(PharBuilder::class);
    $pharBuilder->build(dirname(dirname(dirname(__DIR__))));
} catch (Throwable $exception) {
    $symfonyStyle = SymfonyStyleFactory::create();
    $symfonyStyle->error(sprintf(
        '%s in %s on line %d',
        $throwable->getMessage(),
        $throwable->getFile(),
        $throwable->getLine()
    ));
    exit($throwable->getCode());
}
